"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var _this = this;
Object.defineProperty(exports, "__esModule", { value: true });
var common_1 = require("../common");
describe('Introspector', function () {
    test('CMS/sequences', function () { return __awaiter(_this, void 0, void 0, function () {
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4 /*yield*/, common_1.default("create schema cms;\n    \n    create sequence cms.service_provider_performance_summary_type_id_seq\n    ;\n    \n    create sequence cms.provider_performance_prisma_id_seq\n    ;\n    \n    create sequence cms.service_performance_prisma_id_seq\n    ;\n    \n    create sequence cms.service_provider_performance_prisma_id_seq\n    ;\n    \n    create sequence cms.service_provider_performance_summary_prisma_id_seq\n    ;\n    \n    create table cms.provider_performance\n    (\n        npi integer not null,\n        mcare_participation_indicator text,\n        place_of_service text not null,\n        hcpcs_code text not null,\n        n_of_svcs numeric,\n        n_of_mcare_beneficiaries integer,\n        n_of_distinct_mcare_beneficiary_per_day_svcs integer,\n        avg_mcare_allowed_amt numeric,\n        avg_submitted_charge_amt numeric,\n        avg_mcare_pay_amt numeric,\n        avg_mcare_standardized_amt numeric,\n        prisma_id serial not null\n            constraint provider_performance_prisma_id_pk\n                primary key,\n        constraint provider_performance_npi_hcpcs_code_place_of_service_pk\n            unique (npi, hcpcs_code, place_of_service)\n    )\n    ;\n    \n    create unique index provider_performance_prisma_id_uindex\n        on cms.provider_performance (prisma_id)\n    ;\n    \n    create index provider_performance_mcare_participation_indicator_index\n        on cms.provider_performance (mcare_participation_indicator)\n    ;\n    \n    create index provider_performance_place_of_service_index\n        on cms.provider_performance (place_of_service)\n    ;\n    \n    create index provider_performance_hcpcs_code_index\n        on cms.provider_performance (hcpcs_code)\n    ;\n    \n    create index provider_performance_n_of_svcs_index\n        on cms.provider_performance (n_of_svcs)\n    ;\n    \n    create index provider_performance_n_of_mcare_beneficiaries_index\n        on cms.provider_performance (n_of_mcare_beneficiaries)\n    ;\n    \n    create index provider_performance_n_of_distinct_mcare_beneficiary_pe\n        on cms.provider_performance (n_of_distinct_mcare_beneficiary_per_day_svcs)\n    ;\n    \n    create index provider_performance_avg_mcare_allowed_amt_index\n        on cms.provider_performance (avg_mcare_allowed_amt)\n    ;\n    \n    create index provider_performance_avg_submitted_charge_amt_index\n        on cms.provider_performance (avg_submitted_charge_amt)\n    ;\n    \n    create index provider_performance_avg_mcare_pay_amt_index\n        on cms.provider_performance (avg_mcare_pay_amt)\n    ;\n    \n    create index provider_performance_avg_mcare_standardized_amt_index\n        on cms.provider_performance (avg_mcare_standardized_amt)\n    ;\n    \n    create table cms.providers\n    (\n        npi integer not null\n            constraint providers_npi_pk\n                primary key,\n        entity_type text,\n        provider_type text,\n        address_street_01 text,\n        address_street_02 text,\n        address_city text,\n        address_zip_code text,\n        address_state text,\n        address_country text,\n        address_latitude numeric,\n        address_longitude numeric\n    )\n    ;\n    \n    create index providers_entity_type_index\n        on cms.providers (entity_type)\n    ;\n    \n    create index providers_provider_type_index\n        on cms.providers (provider_type)\n    ;\n    \n    alter table cms.provider_performance\n        add constraint provider_performance_providers_npi_fk\n            foreign key (npi) references cms.providers\n    ;\n    \n    create table cms.service_provider_performance\n    (\n        hcpcs_code text not null,\n        npi integer not null\n            constraint service_provider_performance_providers_npi_fk\n                references cms.providers,\n        entity_type text,\n        n_of_svcs numeric,\n        n_of_distinct_mcare_beneficiary_per_day_svcs integer,\n        n_of_mcare_beneficiaries integer,\n        avg_mcare_pay_amt numeric,\n        avg_submitted_charge_amt numeric,\n        avg_mcare_allowed_amt numeric,\n        avg_mcare_standardized_amt numeric,\n        est_ttl_mcare_pay_amt numeric,\n        est_ttl_submitted_charge_amt numeric,\n        rank_n_of_svcs bigint,\n        rank_n_of_distinct_mcare_beneficiary_per_day_svcs bigint,\n        rank_n_of_mcare_beneficiaries bigint,\n        rank_avg_mcare_standardized_amt bigint,\n        rank_avg_mcare_allowed_amt bigint,\n        rank_avg_submitted_charge_amt bigint,\n        rank_avg_mcare_pay_amt bigint,\n        rank_est_ttl_mcare_pay_amt bigint,\n        rank_est_ttl_submitted_charge_amt bigint,\n        mcare_participation_indicator text,\n        place_of_service text not null,\n        var_avg_mcare_submitted_charge_pay_amt numeric,\n        rank_var_avg_mcare_submitted_charge_pay_amt bigint,\n        prisma_id serial not null\n            constraint service_provider_performance_prisma_id_pk\n                primary key,\n        constraint service_provider_performance_hcpcs_code_npi_place_of_service_pk\n            unique (hcpcs_code, npi, place_of_service)\n    )\n    ;\n    \n    create unique index service_provider_performance_prisma_id_uindex\n        on cms.service_provider_performance (prisma_id)\n    ;\n    \n    create index service_provider_performance_entity_type_index\n        on cms.service_provider_performance (entity_type)\n    ;\n    \n    create index service_provider_performance_rank_n_of_svcs_index\n        on cms.service_provider_performance (rank_n_of_svcs)\n    ;\n    \n    create index service_provider_performance_rank_n_of_distinct_mcare_b\n        on cms.service_provider_performance (rank_n_of_distinct_mcare_beneficiary_per_day_svcs)\n    ;\n    \n    create index service_provider_performance_rank_n_of_mcare_beneficiar\n        on cms.service_provider_performance (rank_n_of_mcare_beneficiaries)\n    ;\n    \n    create index service_provider_performance_rank_avg_mcare_standardized\n        on cms.service_provider_performance (rank_avg_mcare_standardized_amt)\n    ;\n    \n    create index service_provider_performance_rank_avg_mcare_allowed_amou\n        on cms.service_provider_performance (rank_avg_mcare_allowed_amt)\n    ;\n    \n    create index service_provider_performance_rank_avg_submitted_charge_amou\n        on cms.service_provider_performance (rank_avg_submitted_charge_amt)\n    ;\n    \n    create index service_provider_performance_rank_avg_mcare_pay_amou\n        on cms.service_provider_performance (rank_avg_mcare_pay_amt)\n    ;\n    \n    create index service_provider_performance_rank_est_ttl_mcare_pay_am\n        on cms.service_provider_performance (rank_est_ttl_mcare_pay_amt)\n    ;\n    \n    create index service_provider_performance_rank_est_ttl_submitted_charge_am\n        on cms.service_provider_performance (rank_est_ttl_submitted_charge_amt)\n    ;\n    \n    create index service_provider_performance_rank_var_avg_mcare_sub\n        on cms.service_provider_performance (rank_var_avg_mcare_submitted_charge_pay_amt)\n    ;\n    \n    create table cms.services\n    (\n        hcpcs_code text not null\n            constraint svcs_hcpcs_code_pk\n                primary key,\n        hcpcs_description text,\n        hcpcs_drug_indicator text\n    )\n    ;\n    \n    create index svcs_hcpcs_drug_indicator_index\n        on cms.services (hcpcs_drug_indicator)\n    ;\n    \n    alter table cms.provider_performance\n        add constraint provider_performance_cms_svcs_hcpcs_code_fk\n            foreign key (hcpcs_code) references cms.services\n    ;\n    \n    alter table cms.service_provider_performance\n        add constraint service_provider_performance_svcs_hcpcs_code_fk\n            foreign key (hcpcs_code) references cms.services\n    ;\n    \n    create table cms.providers_individuals\n    (\n        npi integer not null\n            constraint providers_individuals_npi_pk\n                primary key\n            constraint providers_individuals_providers_npi_fk\n                references cms.providers,\n        name_last text,\n        name_first text,\n        name_middle text,\n        credentials text,\n        gender text\n    )\n    ;\n    \n    create index providers_individuals_gender_index\n        on cms.providers_individuals (gender)\n    ;\n    \n    create table cms.providers_organizations\n    (\n        npi integer not null\n            constraint providers_organizations_npi_pk\n                primary key\n            constraint providers_organizations_providers_npi_fk\n                references cms.providers,\n        name text\n    )\n    ;\n    \n    create table cms.service_performance\n    (\n        hcpcs_code text not null\n            constraint service_performance_svcs_hcpcs_code_fk\n                references cms.services,\n        entity_type text not null,\n        providers bigint,\n        n_of_svcs numeric,\n        n_of_distinct_mcare_beneficiary_per_day_svcs bigint,\n        n_of_mcare_beneficiaries bigint,\n        avg_avg_mcare_pay_amt numeric,\n        avg_avg_submitted_charge_amt numeric,\n        avg_avg_mcare_allowed_amt numeric,\n        avg_avg_mcare_standardized_amt numeric,\n        min_avg_mcare_pay_amt numeric,\n        max_avg_mcare_pay_amt numeric,\n        var_avg_mcare_pay_amt numeric,\n        min_avg_mcare_allowed_amt numeric,\n        max_avg_mcare_allowed_amt numeric,\n        var_avg_mcare_allowed_amt numeric,\n        min_avg_submitted_charge_amt numeric,\n        max_avg_submitted_charge_amt numeric,\n        var_avg_submitted_charge_amt numeric,\n        min_avg_mcare_standardized_amt numeric,\n        max_avg_mcare_standardized_amt numeric,\n        var_avg_mcare_standardized_amt numeric,\n        est_ttl_mcare_pay_amt numeric,\n        est_ttl_submitted_charge_amt numeric,\n        est_ttl_mcare_allowed_amt numeric,\n        est_ttl_mcare_standardized_amt numeric,\n        rank_providers bigint,\n        rank_n_of_svcs bigint,\n        rank_n_of_distinct_mcare_beneficiary_per_day_svcs bigint,\n        rank_n_of_mcare_beneficiaries bigint,\n        rank_avg_avg_mcare_pay_amt bigint,\n        rank_avg_avg_submitted_charge_amt bigint,\n        rank_avg_avg_mcare_allowed_amt bigint,\n        rank_avg_avg_mcare_standardized_amt bigint,\n        rank_min_avg_mcare_pay_amt bigint,\n        rank_max_avg_mcare_pay_amt bigint,\n        rank_var_avg_mcare_pay_amt bigint,\n        rank_min_avg_mcare_allowed_amt bigint,\n        rank_max_avg_mcare_allowed_amt bigint,\n        rank_var_avg_mcare_allowed_amt bigint,\n        rank_min_avg_submitted_charge_amt bigint,\n        rank_max_avg_submitted_charge_amt bigint,\n        rank_var_avg_submitted_charge_amt bigint,\n        rank_min_avg_mcare_standardized_amt bigint,\n        rank_max_avg_mcare_standardized_amt bigint,\n        rank_var_avg_mcare_standardized_amt bigint,\n        rank_est_ttl_mcare_pay_amt bigint,\n        rank_est_ttl_submitted_charge_amt bigint,\n        rank_est_ttl_mcare_allowed_amt bigint,\n        rank_est_ttl_mcare_standardized_amt bigint,\n        var_avg_mcare_submitted_charge_pay_amt numeric,\n        rank_var_avg_mcare_submitted_charge_pay_amt bigint,\n        prisma_id serial not null\n            constraint service_performance_prisma_id_pk\n                primary key,\n        constraint service_performance_hcpcs_code_entity_type_pk\n            unique (hcpcs_code, entity_type)\n    )\n    ;\n    \n    create unique index service_performance_prisma_id_uindex\n        on cms.service_performance (prisma_id)\n    ;\n    \n    create index service_performance_entity_type_index\n        on cms.service_performance (entity_type)\n    ;\n    \n    create index service_performance_rank_providers_index\n        on cms.service_performance (rank_providers)\n    ;\n    \n    create index service_performance_rank_n_of_svcs_index\n        on cms.service_performance (rank_n_of_svcs)\n    ;\n    \n    create index service_performance_rank_n_of_distinct_mcare_beneficiar\n        on cms.service_performance (rank_n_of_distinct_mcare_beneficiary_per_day_svcs)\n    ;\n    \n    create index service_performance_rank_n_of_mcare_beneficiaries_index\n        on cms.service_performance (rank_n_of_mcare_beneficiaries)\n    ;\n    \n    create index service_performance_rank_avg_avg_mcare_pay_amt_in\n        on cms.service_performance (rank_avg_avg_mcare_pay_amt)\n    ;\n    \n    create index service_performance_rank_avg_avg_submitted_charge_amt_in\n        on cms.service_performance (rank_avg_avg_submitted_charge_amt)\n    ;\n    \n    create index service_performance_rank_avg_avg_mcare_allowed_amt_in\n        on cms.service_performance (rank_avg_avg_mcare_allowed_amt)\n    ;\n    \n    create index service_performance_rank_avg_avg_mcare_standardized_amou\n        on cms.service_performance (rank_avg_avg_mcare_standardized_amt)\n    ;\n    \n    create index service_performance_rank_min_avg_mcare_pay_amt_in\n        on cms.service_performance (rank_min_avg_mcare_pay_amt)\n    ;\n    \n    create index service_performance_rank_max_avg_mcare_pay_amt_in\n        on cms.service_performance (rank_max_avg_mcare_pay_amt)\n    ;\n    \n    create index service_performance_rank_var_avg_mcare_pay_amou\n        on cms.service_performance (rank_var_avg_mcare_pay_amt)\n    ;\n    \n    create index service_performance_rank_min_avg_mcare_allowed_amt_in\n        on cms.service_performance (rank_min_avg_mcare_allowed_amt)\n    ;\n    \n    create index service_performance_rank_max_avg_mcare_allowed_amt_in\n        on cms.service_performance (rank_max_avg_mcare_allowed_amt)\n    ;\n    \n    create index service_performance_rank_var_avg_mcare_allowed_amou\n        on cms.service_performance (rank_var_avg_mcare_allowed_amt)\n    ;\n    \n    create index service_performance_rank_min_avg_submitted_charge_amt_in\n        on cms.service_performance (rank_min_avg_submitted_charge_amt)\n    ;\n    \n    create index service_performance_rank_max_avg_submitted_charge_amt_in\n        on cms.service_performance (rank_max_avg_submitted_charge_amt)\n    ;\n    \n    create index service_performance_rank_var_avg_submitted_charge_amou\n        on cms.service_performance (rank_var_avg_submitted_charge_amt)\n    ;\n    \n    create index service_performance_rank_min_avg_mcare_standardized_amou\n        on cms.service_performance (rank_min_avg_mcare_standardized_amt)\n    ;\n    \n    create index service_performance_rank_max_avg_mcare_standardized_amou\n        on cms.service_performance (rank_max_avg_mcare_standardized_amt)\n    ;\n    \n    create index service_performance_rank_var_avg_mcare_standardized\n        on cms.service_performance (rank_var_avg_mcare_standardized_amt)\n    ;\n    \n    create index service_performance_rank_est_ttl_mcare_pay_amt_inde\n        on cms.service_performance (rank_est_ttl_mcare_pay_amt)\n    ;\n    \n    create index service_performance_rank_est_ttl_submitted_charge_amt_inde\n        on cms.service_performance (rank_est_ttl_submitted_charge_amt)\n    ;\n    \n    create index service_performance_rank_est_ttl_mcare_allowed_amt_inde\n        on cms.service_performance (rank_est_ttl_mcare_allowed_amt)\n    ;\n    \n    create index service_performance_rank_est_ttl_mcare_standardized_amt\n        on cms.service_performance (rank_est_ttl_mcare_standardized_amt)\n    ;\n    \n    create index service_performance_rank_var_avg_mcare_submitted_ch\n        on cms.service_performance (rank_var_avg_mcare_submitted_charge_pay_amt)\n    ;\n    \n    create table cms.service_provider_performance_summary\n    (\n        npi integer not null\n            constraint service_provider_performance_summary_providers_npi_fk\n                references cms.providers,\n        entity_type text,\n        ttl_hcpcs_code text,\n        ttl_n_of_svcs bigint,\n        est_ttl_submitted_charge_amt numeric,\n        est_ttl_mcare_pay_amt numeric,\n        var_est_ttl_mcare_submitted_charge_pay_amt numeric,\n        est_ttl_mcare_pay_amt_by_ttl_hcpcs_code numeric,\n        est_ttl_mcare_pay_amt_by_ttl_n_of_svcs numeric,\n        rank_ttl_hcpcs_code bigint,\n        rank_ttl_n_of_svcs bigint,\n        rank_est_ttl_submitted_charge_amt bigint,\n        rank_est_ttl_mcare_pay_amt bigint,\n        rank_var_est_ttl_mcare_submitted_charge_pay_amoun bigint,\n        rank_est_ttl_mcare_pay_amt_by_ttl_hcpcs_code bigint,\n        rank_est_ttl_mcare_pay_amt_by_ttl_n_of_servi bigint,\n        summary_type integer not null,\n        prisma_id serial not null\n            constraint service_provider_performance_summary_prisma_id_pk\n                primary key,\n        constraint service_provider_performance_summary_npi_summary_type_pk\n            unique (npi, summary_type)\n    )\n    ;\n    \n    create unique index service_provider_performance_summary_prisma_id_uindex\n        on cms.service_provider_performance_summary (prisma_id)\n    ;\n    \n    create index service_provider_performance_summary_entity_type_index\n        on cms.service_provider_performance_summary (entity_type)\n    ;\n    \n    create index prvdr_smry_rank_ttl_hcpcs_code_index\n        on cms.service_provider_performance_summary (rank_ttl_hcpcs_code)\n    ;\n    \n    create index prvdr_smry_rank_ttl_n_of_svcs_index\n        on cms.service_provider_performance_summary (rank_ttl_n_of_svcs)\n    ;\n    \n    create index prvdr_smry_rank_est_ttl_submitted_charge_amt_index\n        on cms.service_provider_performance_summary (rank_est_ttl_submitted_charge_amt)\n    ;\n    \n    create index prvdr_smry_rank_est_ttl_mcare_pay_amt_index\n        on cms.service_provider_performance_summary (rank_est_ttl_mcare_pay_amt)\n    ;\n    \n    create index prvdr_smry_rank_var_est_ttl_mcare_submitted_charge_pa\n        on cms.service_provider_performance_summary (rank_var_est_ttl_mcare_submitted_charge_pay_amoun)\n    ;\n    \n    create index prvdr_smry_rank_est_ttl_mcare_pay_amt_by_ttl_hcpc\n        on cms.service_provider_performance_summary (rank_est_ttl_mcare_pay_amt_by_ttl_hcpcs_code)\n    ;\n    \n    create index prvdr_smry_rank_est_ttl_mcare_pay_amt_by_ttl_numb\n        on cms.service_provider_performance_summary (rank_est_ttl_mcare_pay_amt_by_ttl_n_of_servi)\n    ;\n    \n    create table cms.service_provider_performance_summary_type\n    (\n        id serial not null\n            constraint service_provider_performance_summary_type_pkey\n                primary key,\n        slug varchar(20),\n        description text not null,\n        group_membership boolean default true not null\n    )\n    ;\n    \n    create unique index service_provider_performance_summary_type_slug_uindex\n        on cms.service_provider_performance_summary_type (slug)\n    ;\n    \n    alter table cms.service_provider_performance_summary\n        add constraint service_provider_performance_summary_service_provider_performan\n            foreign key (summary_type) references cms.service_provider_performance_summary_type\n    ;\n    \n    CREATE VIEW cms.live_service_performance AS SELECT performance.hcpcs_code,\n        providers.entity_type,\n        count(performance.npi) AS providers,\n        sum(performance.n_of_svcs) AS n_of_svcs,\n        sum(performance.n_of_distinct_mcare_beneficiary_per_day_svcs) AS n_of_distinct_mcare_beneficiary_per_day_svcs,\n        sum(performance.n_of_mcare_beneficiaries) AS n_of_mcare_beneficiaries,\n        avg(performance.avg_mcare_pay_amt) AS avg_avg_mcare_pay_amt,\n        avg(performance.avg_submitted_charge_amt) AS avg_avg_submitted_charge_amt,\n        (avg(performance.avg_submitted_charge_amt) - avg(performance.avg_mcare_pay_amt)) AS var_avg_mcare_submitted_charge_pay_amt,\n        avg(performance.avg_mcare_allowed_amt) AS avg_avg_mcare_allowed_amt,\n        avg(performance.avg_mcare_standardized_amt) AS avg_avg_mcare_standardized_amt,\n        min(performance.avg_mcare_pay_amt) AS min_avg_mcare_pay_amt,\n        max(performance.avg_mcare_pay_amt) AS max_avg_mcare_pay_amt,\n        (max(performance.avg_mcare_pay_amt) - min(performance.avg_mcare_pay_amt)) AS var_avg_mcare_pay_amt,\n        min(performance.avg_mcare_allowed_amt) AS min_avg_mcare_allowed_amt,\n        max(performance.avg_mcare_allowed_amt) AS max_avg_mcare_allowed_amt,\n        (max(performance.avg_mcare_allowed_amt) - min(performance.avg_mcare_allowed_amt)) AS var_avg_mcare_allowed_amt,\n        min(performance.avg_submitted_charge_amt) AS min_avg_submitted_charge_amt,\n        max(performance.avg_submitted_charge_amt) AS max_avg_submitted_charge_amt,\n        (max(performance.avg_submitted_charge_amt) - min(performance.avg_submitted_charge_amt)) AS var_avg_submitted_charge_amt,\n        min(performance.avg_mcare_standardized_amt) AS min_avg_mcare_standardized_amt,\n        max(performance.avg_mcare_standardized_amt) AS max_avg_mcare_standardized_amt,\n        (max(performance.avg_mcare_standardized_amt) - min(performance.avg_mcare_standardized_amt)) AS var_avg_mcare_standardized_amt,\n        (avg(performance.avg_mcare_pay_amt) * sum(performance.n_of_svcs)) AS est_ttl_mcare_pay_amt,\n        (avg(performance.avg_submitted_charge_amt) * sum(performance.n_of_svcs)) AS est_ttl_submitted_charge_amt,\n        (avg(performance.avg_mcare_allowed_amt) * sum(performance.n_of_svcs)) AS est_ttl_mcare_allowed_amt,\n        (avg(performance.avg_mcare_standardized_amt) * sum(performance.n_of_svcs)) AS est_ttl_mcare_standardized_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (count(performance.npi)) DESC) AS rank_providers,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (sum(performance.n_of_svcs)) DESC) AS rank_n_of_svcs,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (sum(performance.n_of_distinct_mcare_beneficiary_per_day_svcs)) DESC) AS rank_n_of_distinct_mcare_beneficiary_per_day_svcs,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (sum(performance.n_of_mcare_beneficiaries)) DESC) AS rank_n_of_mcare_beneficiaries,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (avg(performance.avg_mcare_pay_amt)) DESC) AS rank_avg_avg_mcare_pay_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (avg(performance.avg_submitted_charge_amt)) DESC) AS rank_avg_avg_submitted_charge_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (avg(performance.avg_submitted_charge_amt) - avg(performance.avg_mcare_pay_amt)) DESC) AS rank_var_avg_mcare_submitted_charge_pay_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (avg(performance.avg_mcare_allowed_amt)) DESC) AS rank_avg_avg_mcare_allowed_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (avg(performance.avg_mcare_standardized_amt)) DESC) AS rank_avg_avg_mcare_standardized_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (min(performance.avg_mcare_pay_amt)) DESC) AS rank_min_avg_mcare_pay_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (max(performance.avg_mcare_pay_amt)) DESC) AS rank_max_avg_mcare_pay_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (max(performance.avg_mcare_pay_amt) - min(performance.avg_mcare_pay_amt)) DESC) AS rank_var_avg_mcare_pay_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (min(performance.avg_mcare_allowed_amt)) DESC) AS rank_min_avg_mcare_allowed_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (max(performance.avg_mcare_allowed_amt)) DESC) AS rank_max_avg_mcare_allowed_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (max(performance.avg_mcare_allowed_amt) - min(performance.avg_mcare_allowed_amt)) DESC) AS rank_var_avg_mcare_allowed_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (min(performance.avg_submitted_charge_amt)) DESC) AS rank_min_avg_submitted_charge_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (max(performance.avg_submitted_charge_amt)) DESC) AS rank_max_avg_submitted_charge_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (max(performance.avg_submitted_charge_amt) - min(performance.avg_submitted_charge_amt)) DESC) AS rank_var_avg_submitted_charge_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (min(performance.avg_mcare_standardized_amt)) DESC) AS rank_min_avg_mcare_standardized_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (max(performance.avg_mcare_standardized_amt)) DESC) AS rank_max_avg_mcare_standardized_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (max(performance.avg_mcare_standardized_amt) - min(performance.avg_mcare_standardized_amt)) DESC) AS rank_var_avg_mcare_standardized_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (avg(performance.avg_mcare_pay_amt) * sum(performance.n_of_svcs)) DESC) AS rank_est_ttl_mcare_pay_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (avg(performance.avg_submitted_charge_amt) * sum(performance.n_of_svcs)) DESC) AS rank_est_ttl_submitted_charge_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (avg(performance.avg_mcare_allowed_amt) * sum(performance.n_of_svcs)) DESC) AS rank_est_ttl_mcare_allowed_amt,\n        rank() OVER (PARTITION BY providers.entity_type ORDER BY (avg(performance.avg_mcare_standardized_amt) * sum(performance.n_of_svcs)) DESC) AS rank_est_ttl_mcare_standardized_amt\n       FROM (cms.provider_performance performance\n         JOIN cms.providers providers ON ((providers.npi = performance.npi)))\n      GROUP BY performance.hcpcs_code, providers.entity_type\n    ;\n    \n    CREATE VIEW cms.live_service_provider_performance AS SELECT performance.hcpcs_code,\n        performance.npi,\n        providers.entity_type,\n        performance.mcare_participation_indicator,\n        performance.place_of_service,\n        performance.n_of_svcs,\n        performance.n_of_distinct_mcare_beneficiary_per_day_svcs,\n        performance.n_of_mcare_beneficiaries,\n        performance.avg_mcare_pay_amt,\n        performance.avg_submitted_charge_amt,\n        (performance.avg_submitted_charge_amt - performance.avg_mcare_pay_amt) AS var_avg_mcare_submitted_charge_pay_amt,\n        performance.avg_mcare_allowed_amt,\n        performance.avg_mcare_standardized_amt,\n        (performance.avg_mcare_pay_amt * performance.n_of_svcs) AS est_ttl_mcare_pay_amt,\n        (performance.avg_submitted_charge_amt * performance.n_of_svcs) AS est_ttl_submitted_charge_amt,\n        rank() OVER (PARTITION BY performance.hcpcs_code, providers.entity_type ORDER BY performance.hcpcs_code, performance.n_of_svcs DESC) AS rank_n_of_svcs,\n        rank() OVER (PARTITION BY performance.hcpcs_code, providers.entity_type ORDER BY performance.hcpcs_code, performance.n_of_distinct_mcare_beneficiary_per_day_svcs DESC) AS rank_n_of_distinct_mcare_beneficiary_per_day_svcs,\n        rank() OVER (PARTITION BY performance.hcpcs_code, providers.entity_type ORDER BY performance.hcpcs_code, performance.n_of_mcare_beneficiaries DESC) AS rank_n_of_mcare_beneficiaries,\n        rank() OVER (PARTITION BY performance.hcpcs_code, providers.entity_type ORDER BY performance.hcpcs_code, performance.avg_mcare_standardized_amt DESC) AS rank_avg_mcare_standardized_amt,\n        rank() OVER (PARTITION BY performance.hcpcs_code, providers.entity_type ORDER BY performance.hcpcs_code, (performance.avg_submitted_charge_amt - performance.avg_mcare_pay_amt) DESC) AS rank_var_avg_mcare_submitted_charge_pay_amt,\n        rank() OVER (PARTITION BY performance.hcpcs_code, providers.entity_type ORDER BY performance.hcpcs_code, performance.avg_mcare_allowed_amt DESC) AS rank_avg_mcare_allowed_amt,\n        rank() OVER (PARTITION BY performance.hcpcs_code, providers.entity_type ORDER BY performance.hcpcs_code, performance.avg_submitted_charge_amt DESC) AS rank_avg_submitted_charge_amt,\n        rank() OVER (PARTITION BY performance.hcpcs_code, providers.entity_type ORDER BY performance.hcpcs_code, performance.avg_mcare_pay_amt DESC) AS rank_avg_mcare_pay_amt,\n        rank() OVER (PARTITION BY performance.hcpcs_code, providers.entity_type ORDER BY performance.hcpcs_code, (performance.avg_mcare_pay_amt * performance.n_of_svcs) DESC) AS rank_est_ttl_mcare_pay_amt,\n        rank() OVER (PARTITION BY performance.hcpcs_code, providers.entity_type ORDER BY performance.hcpcs_code, (performance.avg_submitted_charge_amt * performance.n_of_svcs) DESC) AS rank_est_ttl_submitted_charge_amt\n       FROM (cms.provider_performance performance\n         JOIN cms.providers providers ON ((providers.npi = performance.npi)))\n      GROUP BY performance.hcpcs_code, performance.npi, providers.entity_type, performance.mcare_participation_indicator, performance.place_of_service, performance.n_of_svcs, performance.n_of_distinct_mcare_beneficiary_per_day_svcs, performance.n_of_mcare_beneficiaries, performance.avg_mcare_pay_amt, performance.avg_submitted_charge_amt, performance.avg_mcare_allowed_amt, performance.avg_mcare_standardized_amt\n      ORDER BY performance.hcpcs_code, providers.entity_type, performance.n_of_svcs DESC\n    ;\n    \n    CREATE VIEW cms.live_service_provider_performance_summary_drug_no AS SELECT 3 AS summary_type,\n        performance.npi,\n        performance.entity_type,\n        count(performance.hcpcs_code) AS ttl_hcpcs_code,\n        sum(performance.n_of_svcs) AS ttl_n_of_svcs,\n        sum(performance.est_ttl_submitted_charge_amt) AS est_ttl_submitted_charge_amt,\n        sum(performance.est_ttl_mcare_pay_amt) AS est_ttl_mcare_pay_amt,\n        (sum(performance.est_ttl_submitted_charge_amt) - sum(performance.est_ttl_mcare_pay_amt)) AS var_est_ttl_mcare_submitted_charge_pay_amt,\n        (sum(performance.est_ttl_mcare_pay_amt) / (count(performance.hcpcs_code))::numeric) AS est_ttl_mcare_pay_amt_by_ttl_hcpcs_code,\n        (sum(performance.est_ttl_mcare_pay_amt) / sum(performance.n_of_svcs)) AS est_ttl_mcare_pay_amt_by_ttl_n_of_svcs,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (count(performance.hcpcs_code)) DESC) AS rank_ttl_hcpcs_code,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.n_of_svcs)) DESC) AS rank_ttl_n_of_svcs,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_submitted_charge_amt)) DESC) AS rank_est_ttl_submitted_charge_amt,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_mcare_pay_amt)) DESC) AS rank_est_ttl_mcare_pay_amt,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_submitted_charge_amt) - sum(performance.est_ttl_mcare_pay_amt)) DESC) AS rank_var_est_ttl_mcare_submitted_charge_pay_amoun,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_mcare_pay_amt) / (count(performance.hcpcs_code))::numeric) DESC) AS rank_est_ttl_mcare_pay_amt_by_ttl_hcpcs_code,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_mcare_pay_amt) / sum(performance.n_of_svcs)) DESC) AS rank_est_ttl_mcare_pay_amt_by_ttl_n_of_servi\n       FROM (cms.service_provider_performance performance\n         JOIN cms.services svcs ON ((svcs.hcpcs_code = performance.hcpcs_code)))\n      WHERE (svcs.hcpcs_drug_indicator = 'N'::text)\n      GROUP BY performance.npi, performance.entity_type\n    ;\n    \n    CREATE VIEW cms.live_service_provider_performance_summary_drug_yes AS SELECT 2 AS summary_type,\n        performance.npi,\n        performance.entity_type,\n        count(performance.hcpcs_code) AS ttl_hcpcs_code,\n        sum(performance.n_of_svcs) AS ttl_n_of_svcs,\n        sum(performance.est_ttl_submitted_charge_amt) AS est_ttl_submitted_charge_amt,\n        sum(performance.est_ttl_mcare_pay_amt) AS est_ttl_mcare_pay_amt,\n        (sum(performance.est_ttl_submitted_charge_amt) - sum(performance.est_ttl_mcare_pay_amt)) AS var_est_ttl_mcare_submitted_charge_pay_amt,\n        (sum(performance.est_ttl_mcare_pay_amt) / (count(performance.hcpcs_code))::numeric) AS est_ttl_mcare_pay_amt_by_ttl_hcpcs_code,\n        (sum(performance.est_ttl_mcare_pay_amt) / sum(performance.n_of_svcs)) AS est_ttl_mcare_pay_amt_by_ttl_n_of_svcs,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (count(performance.hcpcs_code)) DESC) AS rank_ttl_hcpcs_code,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.n_of_svcs)) DESC) AS rank_ttl_n_of_svcs,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_submitted_charge_amt)) DESC) AS rank_est_ttl_submitted_charge_amt,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_mcare_pay_amt)) DESC) AS rank_est_ttl_mcare_pay_amt,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_submitted_charge_amt) - sum(performance.est_ttl_mcare_pay_amt)) DESC) AS rank_var_est_ttl_mcare_submitted_charge_pay_amoun,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_mcare_pay_amt) / (count(performance.hcpcs_code))::numeric) DESC) AS rank_est_ttl_mcare_pay_amt_by_ttl_hcpcs_code,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_mcare_pay_amt) / sum(performance.n_of_svcs)) DESC) AS rank_est_ttl_mcare_pay_amt_by_ttl_n_of_servi\n       FROM (cms.service_provider_performance performance\n         JOIN cms.services svcs ON ((svcs.hcpcs_code = performance.hcpcs_code)))\n      WHERE (svcs.hcpcs_drug_indicator = 'Y'::text)\n      GROUP BY performance.npi, performance.entity_type\n    ;\n    \n    CREATE VIEW cms.live_service_provider_performance_summary_overall AS SELECT 1 AS summary_type,\n        performance.npi,\n        performance.entity_type,\n        count(performance.hcpcs_code) AS ttl_hcpcs_code,\n        sum(performance.n_of_svcs) AS ttl_n_of_svcs,\n        sum(performance.est_ttl_submitted_charge_amt) AS est_ttl_submitted_charge_amt,\n        sum(performance.est_ttl_mcare_pay_amt) AS est_ttl_mcare_pay_amt,\n        (sum(performance.est_ttl_submitted_charge_amt) - sum(performance.est_ttl_mcare_pay_amt)) AS var_est_ttl_mcare_submitted_charge_pay_amt,\n        (sum(performance.est_ttl_mcare_pay_amt) / (count(performance.hcpcs_code))::numeric) AS est_ttl_mcare_pay_amt_by_ttl_hcpcs_code,\n        (sum(performance.est_ttl_mcare_pay_amt) / sum(performance.n_of_svcs)) AS est_ttl_mcare_pay_amt_by_ttl_n_of_svcs,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (count(performance.hcpcs_code)) DESC) AS rank_ttl_hcpcs_code,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.n_of_svcs)) DESC) AS rank_ttl_n_of_svcs,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_submitted_charge_amt)) DESC) AS rank_est_ttl_submitted_charge_amt,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_mcare_pay_amt)) DESC) AS rank_est_ttl_mcare_pay_amt,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_submitted_charge_amt) - sum(performance.est_ttl_mcare_pay_amt)) DESC) AS rank_var_est_ttl_mcare_submitted_charge_pay_amoun,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_mcare_pay_amt) / (count(performance.hcpcs_code))::numeric) DESC) AS rank_est_ttl_mcare_pay_amt_by_ttl_hcpcs_code,\n        rank() OVER (PARTITION BY performance.entity_type ORDER BY (sum(performance.est_ttl_mcare_pay_amt) / sum(performance.n_of_svcs)) DESC) AS rank_est_ttl_mcare_pay_amt_by_ttl_n_of_servi\n       FROM cms.service_provider_performance performance\n      GROUP BY performance.npi, performance.entity_type\n    ;  \n    ", 'cms', false)];
                case 1:
                    _a.sent();
                    return [2 /*return*/];
            }
        });
    }); });
});
//# sourceMappingURL=cms.js.map